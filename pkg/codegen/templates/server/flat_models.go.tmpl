{{/*
SPDX-FileCopyrightText: 2025 OpenCHAMI a Series of LF Projects, LLC

SPDX-License-Identifier: MIT
*/}}
// Code generated by Fabrica {{.Version}}. DO NOT EDIT.
// Template: {{.Template}}
//
// This file contains "Flat" models that combine Spec and Status into a single JSON object.
// These models are used for the simplified /spec2 API routes.

package {{.PackageName}}

import (
	"time"
	"github.com/openchami/fabrica/pkg/resource"
	{{range .Resources}}
	"{{.Package}}"
	{{end}}
)

{{range .Resources}}
// {{.Name}}Flat represents a flattened view of the {{.Name}} resource.
// It combines Metadata, Spec, and Status into a single JSON structure.
type {{.Name}}Flat struct {
	// Metadata fields mapped to top-level
	ID          string            `json:"id,omitempty"`
	Name        string            `json:"name,omitempty"`
	Labels      map[string]string `json:"labels,omitempty"`
	Annotations map[string]string `json:"annotations,omitempty"`
	CreatedAt   time.Time         `json:"createdAt,omitempty"`
	UpdatedAt   time.Time         `json:"updatedAt,omitempty"`

	// Embed Spec (Inline) - these fields appear at the top level
	{{.SpecType}} `json:",inline"`

	// Embed Status (Inline) - these fields appear at the top level
	// Note: conflicting field names between Spec and Status will result in undefined JSON behavior
	{{.StatusType}} `json:",inline"`
}

// {{.Name}}ToFlat converts a standard Envelope resource to a Flat model
func {{.Name}}ToFlat(r *{{.PackageAlias}}.{{.Name}}) *{{.Name}}Flat {
	if r == nil {
		return nil
	}
	return &{{.Name}}Flat{
		ID:          r.Metadata.UID,
		Name:        r.Metadata.Name,
		Labels:      r.Metadata.Labels,
		Annotations: r.Metadata.Annotations,
		CreatedAt:   r.Metadata.CreatedAt,
		UpdatedAt:   r.Metadata.UpdatedAt,
		{{.Name}}Spec:   r.Spec,
		{{.Name}}Status: r.Status,
	}
}

// {{.Name}}FromFlat converts a Flat model back to a standard Envelope resource.
// NOTE: This strictly ignores Status fields to prevent users from spoofing observed state.
func {{.Name}}FromFlat(f *{{.Name}}Flat) *{{.PackageAlias}}.{{.Name}} {
	res := &{{.PackageAlias}}.{{.Name}}{
		Resource: resource.Resource{
			Kind: "{{.Name}}",
		},
		Spec: f.{{.Name}}Spec,
		// Status is intentionally ignored on input
	}

	// Initialize Metadata
	res.Metadata.Name = f.Name
	res.Metadata.UID = f.ID
	res.Metadata.Labels = f.Labels
	res.Metadata.Annotations = f.Annotations
	
	return res
}
{{end}}